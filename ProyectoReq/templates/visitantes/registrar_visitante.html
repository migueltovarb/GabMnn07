{% extends 'base.html' %}
{% load static %}

{% block title %}Registrar Visitante - Sistema de Gestión{% endblock %}

{% block content %}
<div class="form-container">
    <h2 class="form-title">
        <i class="fas fa-user-plus"></i> Registrar Nuevo Visitante
    </h2>

    <form method="post" novalidate class="registration-form">
        {% csrf_token %}

        <div style="background: #e3f2fd; padding: 15px; border-radius: 5px; margin-bottom: 25px; display: flex; gap: 10px;">
            <i class="fas fa-info-circle" style="color: #1976d2; min-width: 20px;"></i>
            <p style="color: #1565c0; font-size: 14px; margin: 0;">
                Por favor completa todos los campos marcados con <span style="color: #e74c3c;">*</span> para continuar.
            </p>
        </div>

        <!-- Información Personal -->
        <fieldset style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
            <legend style="padding: 0 10px; font-weight: 600; color: #0f3460; font-size: 16px;">
                <i class="fas fa-user"></i> Información Personal
            </legend>

            <div class="form-group required">
                <label for="id_nombre">Nombre Completo</label>
                <input 
                    type="text" 
                    name="nombre" 
                    id="id_nombre"
                    placeholder="Ej: Juan Pérez García"
                    required
                    {% if form.nombre.errors %}class="form-error"{% endif %}
                >
                {% if form.nombre.errors %}
                <ul class="errorlist">
                    {% for error in form.nombre.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="form-group required">
                <label for="id_tipo_documento">Tipo de Documento</label>
                <select name="tipo_documento" id="id_tipo_documento" required {% if form.tipo_documento.errors %}class="form-error"{% endif %}>
                    <option value="">-- Selecciona un tipo --</option>
                    <option value="CC">Cédula de Ciudadanía (CC)</option>
                    <option value="TI">Tarjeta de Identidad (TI)</option>
                    <option value="PP">Pasaporte (PP)</option>
                    <option value="CE">Cédula de Extranjería (CE)</option>
                </select>
                {% if form.tipo_documento.errors %}
                <ul class="errorlist">
                    {% for error in form.tipo_documento.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="form-group required">
                <label for="id_documento">Número de Documento</label>
                <input 
                    type="text" 
                    name="documento" 
                    id="id_documento"
                    placeholder="Ej: 1234567890"
                    required
                    {% if form.documento.errors %}class="form-error"{% endif %}
                >
                <p class="form-help"><i class="fas fa-info-circle"></i> Solo números, sin caracteres especiales</p>
                {% if form.documento.errors %}
                <ul class="errorlist">
                    {% for error in form.documento.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="id_email">Correo Electrónico</label>
                <input 
                    type="email" 
                    name="email" 
                    id="id_email"
                    placeholder="ejemplo@correo.com"
                    {% if form.email.errors %}class="form-error"{% endif %}
                >
                {% if form.email.errors %}
                <ul class="errorlist">
                    {% for error in form.email.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="id_telefono">Teléfono / Celular</label>
                <input 
                    type="tel" 
                    name="telefono" 
                    id="id_telefono"
                    placeholder="Ej: 3001234567"
                    {% if form.telefono.errors %}class="form-error"{% endif %}
                >
                {% if form.telefono.errors %}
                <ul class="errorlist">
                    {% for error in form.telefono.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
                {% endif %}
            </div>
        </fieldset>

        <!-- Información de la Visita -->
        <fieldset style="border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
            <legend style="padding: 0 10px; font-weight: 600; color: #0f3460; font-size: 16px;">
                <i class="fas fa-calendar-alt"></i> Información de la Visita
            </legend>

            <div class="form-group required">
                <label for="id_motivo_visita">Motivo de la Visita</label>
                <select name="motivo_visita" id="id_motivo_visita" required {% if form.motivo_visita.errors %}class="form-error"{% endif %}>
                    <option value="">-- Selecciona un motivo --</option>
                    <option value="Negocios">Negocios</option>
                    <option value="Visita Personal">Visita Personal</option>
                    <option value="Mantenimiento">Mantenimiento</option>
                    <option value="Entrega de Paquete">Entrega de Paquete</option>
                    <option value="Reparación">Reparación</option>
                    <option value="Otro">Otro</option>
                </select>
                {% if form.motivo_visita.errors %}
                <ul class="errorlist">
                    {% for error in form.motivo_visita.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="form-group required">
                <label for="id_apartamento_visitado">Apartamento/Oficina a Visitar</label>
                <input 
                    type="text" 
                    name="apartamento_visitado" 
                    id="id_apartamento_visitado"
                    placeholder="Ej: Apt 301, Piso 5"
                    required
                    {% if form.apartamento_visitado.errors %}class="form-error"{% endif %}
                >
                {% if form.apartamento_visitado.errors %}
                <ul class="errorlist">
                    {% for error in form.apartamento_visitado.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="form-group required">
                <label for="id_persona_a_visitar">Nombre de la Persona a Visitar</label>
                <input 
                    type="text" 
                    name="persona_a_visitar" 
                    id="id_persona_a_visitar"
                    placeholder="Ej: Carlos Rodríguez"
                    required
                    {% if form.persona_a_visitar.errors %}class="form-error"{% endif %}
                >
                {% if form.persona_a_visitar.errors %}
                <ul class="errorlist">
                    {% for error in form.persona_a_visitar.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="id_descripcion">Descripción Adicional</label>
                <textarea 
                    name="descripcion" 
                    id="id_descripcion"
                    placeholder="Notas o detalles adicionales sobre la visita..."
                    {% if form.descripcion.errors %}class="form-error"{% endif %}
                ></textarea>
                {% if form.descripcion.errors %}
                <ul class="errorlist">
                    {% for error in form.descripcion.errors %}<li>{{ error }}</li>{% endfor %}
                </ul>
                {% endif %}
            </div>
        </fieldset>

        {% if form.non_field_errors %}
        <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 5px; margin-bottom: 25px; display: flex; gap: 10px;">
            <i class="fas fa-exclamation-circle" style="min-width: 20px;"></i>
            <div>
                {% for error in form.non_field_errors %}
                <p style="margin: 0;">{{ error }}</p>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="form-buttons">
            <button type="submit" class="btn btn-success btn-block">
                <i class="fas fa-check"></i> Registrar Visitante
            </button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary btn-block">
                <i class="fas fa-arrow-left"></i> Cancelar
            </a>
        </div>
    </form>
</div>

{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('.registration-form');
        
        form.addEventListener('submit', function(e) {
            const requiredFields = form.querySelectorAll('input[required], select[required], textarea[required]');
            let hasErrors = false;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('form-error');
                    hasErrors = true;
                }
            });

            if (hasErrors) {
                e.preventDefault();
                requiredFields[0].focus();
            }
        });
    });
</script>
{% endblock %}